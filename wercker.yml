box:
  id: haskell:8.6.5
  env:
    CACHE: $WERCKER_CACHE_DIR/cache.tar.gz

build:
  steps:
    - script:
        name: expand cache
        code: |
          if [ -f $CACHE ]; then
            tar zvxf $CACHE
          fi

    - script:
        name: build
        code: |
          stack install --local-bin-path "$WERCKER_REPORT_ARTIFACTS_DIR" --split-objs --flag dhash:static --ghc-options -fPIC

    - script:
        name: make cache
        code: |
          tar c ~/.stack | gzip --fast > $CACHE
          ls -lh $WERCKER_CACHE_DIR
